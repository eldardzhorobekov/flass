{% for chat in tickets | groupby('chat_name') %}
ğŸ· **ĞšĞĞĞĞ›: {{ chat.grouper | upper }}**
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
{% set ow_tickets = chat.list | selectattr('date_end', 'none') | list %}
{% set rt_tickets = chat.list | rejectattr('date_end', 'none') | list %}

{# --- Ğ’ Ğ¾Ğ´Ğ½Ñƒ ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñƒ --- #}
{% for route in ow_tickets | groupby('group_key_simple') %}
{% set first = route.list[0] %}
ğŸ“ {{ first.route_from | iata_to_ru }} â” {{ first.route_to | iata_to_ru }}
{% for t in route.list %}
ğŸ—“ {{ t.date_start.strftime('%d.%m') }}  â€”  ğŸ’° **{{ t.price }} {{ t.currency }}** [ğŸ‘‰ Ğ’Ğ·ÑÑ‚ÑŒ](https://t.me/{{ t.chat_name }}/{{ t.message_id }})
{% endfor %}
{% endfor %}

{% if ow_tickets and rt_tickets %}

{% endif %}
{# --- Ğ¢ÑƒĞ´Ğ°-ĞĞ±Ñ€Ğ°Ñ‚Ğ½Ğ¾ --- #}
{% for route in rt_tickets | groupby('group_key_simple') %}
{% set first = route.list[0] %}
ğŸ“ {{ first.route_from | iata_to_ru }} â” {{ first.route_to | iata_to_ru }} â” {{ first.route_from | iata_to_ru }}
{% for t in route.list %}
{% set nights = (t.date_end - t.date_start).days %}
ğŸ—“ {{ t.date_start.strftime('%d.%m') }} - {{ t.date_end.strftime('%d.%m') }} ({{ nights }}Ğ½)  â€”  ğŸ’° **{{ t.price }} {{ t.currency }}** [ğŸ‘‰ Ğ’Ğ·ÑÑ‚ÑŒ](https://t.me/{{ t.chat_name }}/{{ t.message_id }})
{% endfor %}
{% endfor %}

{% endfor %}